#------->Normalización ( which is necessary to make accurate comparisons of gene expression between samples.)
-Método:DESeq2’s median of ratios [1]
-Descripción:counts divided by sample-specific size factors determined by median ratio of gene counts relative to geometric mean per gene
-Factores a tener en cuenta:sequencing depth and RNA composition
-Uso recomendado:gene count comparisons between samples and for DE analysis; NOT for within sample comparisons
-Detalles:https://hbctraining.github.io/DGE_workshop/lessons/02_DGE_count_normalization.html

#While normalization is essential for differential expression analyses, it is also necessary for exploratory data analysis, 
#visualization of data, and whenever you are exploring or comparing counts between or within samples.
#Since tools for differential expression analysis are comparing the counts between sample groups for the same gene, 
#gene length does not need to be accounted for by the tool. However, sequencing depth and RNA composition do need to be taken into account.
# normalized=True divide cada columna por su size factor (seq depth)
#For the log2 approach, we need to first estimate size factors to account for sequencing depth, and then specify normalized=TRUE

NOTAS DEL CURSO DE ARN-SEQ DE EDX

3.Normalizing for sequencing depth:
And the actual counts matrix is stored in assay.
So if we look at the head of assay(airway),
we have the counts for the eight samples.
If we want to compare samples, for example,
to calculate the distance between samples, we have for each sample
a vector of counts-- the number of paired end
reads which align to each gene.
And there are number of things that we want to control for.
One of these is the sequencing depth, so the number of reads which
were aligned to genes, for example.
So if we type colSums(assay(airway)), we'll get the number of paired end
reads which align to the genes for each sample.
And we can sort this and divide by a million,
and we see the range is from 15 million to 30 million.
This is a technical artifact that we want to control for.
Another aspect that we want to control for
is the fact that if we just look at the raw counts,
the variance is much higher for large counts than for small counts.
So if we were comparing the raw counts vector,
the genes that have a very high count would be more important,
and they would be adding more information
to the distance than the small count genes.

4.Transformations and variance:
So in this lab, we're going to discuss a more sophisticated transformation,
which helps to stabilize the variance at different levels of the mean.
So DESeq2 package has two methods for stabilizing variance.
One is called the variance stabilizing transformation.
There we go.
And the other one is called rlog for regularized logarithm.
And we're going to use the rlog.
So we say in the help that the rlog is more robust in the case
where the size factors vary widely.

So this stabilization of the variance is a useful property of the rlog.

So the principal component plot is a highly recommended exploratory plot
to make before you start testing, just to have
a sense of the variance of the data.
So just by reading this plot, we see that while there are differences
due to dexamethasone treatment, there's also
a large difference in one of the cell types to the other three cell types.
And so, just by looking at a PCA plot, you
can get a very quick idea of the variance in your data set.

6.Modeling raw counts:
In the previous videos, we looked at transformations
of count data, which allowed us to stabilize the variance so we
could calculate distances, for example.
For differential gene expression, we're going
to use software which models the raw count
values and takes into account normalization factors such as the size
factor which adjusts for sequencing depth.

